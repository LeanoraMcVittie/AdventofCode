That was an extremely unpleasant debugging process, and I am not at all happy that the solution that works on the official input does not work on the example input, and, in fact, only works on inputs where algorithm[0] is # and algorithm[-1] is '.'

But it is well past my bedtime and I am long past the point of enjoying this puzzle so I'm leaving it as it is
